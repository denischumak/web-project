# Инструкция по запуску проекта
1. Для начала необходимо поставить docker на локальную машину.
  
Если у вас Windows, рекомендуется установить Docker Deskstop:  https://www.docker.com/get-started/  
  
Если у вас Linux, используйте команды:
```
sudo apt-get update
sudo apt-get install -y docker-compose 
```
2. Необходимо склонировать репозиторий:
```
git clone https://github.com/denischumak/web-project
```
3. Перейти в папку проекта:
```
 cd ./web-project
```
4. Выполнить команду для сборки и запуска контейнера:
```
docker-compose up
```
5. Откройте сайт:
```
http://localhost:5000/
```
# ТЗ проекта, оформленное в XML формате
https://drive.google.com/drive/folders/1hFUaBbwNEqiDRHfHx0AlXDsEBJxi4oT9?dmr=1&ec=wgc-drive-globalnav-goto

# Описание проекта
Проект представляет собой веб-сервис по покупке товаров. В магазине используется двенадцать различных валют. Чтобы получить деньги на мультивалютный счет, необходима регистрация, после чего на ваш счет поступит случайное число денег при нажатии соответствующей кнопки в личном кабинете. Обратите внимание, что бонус доступен лишь один раз.  

Большинство товары имеют случайную цену и валюту, которые обновляется при каждом обновлении сайта. Остальные имеют фиксированную цену и валюту. Список товаров случайно выбирается при каждом обновлении. С вероятоностью 10% на товар можно получить скидку. Будьте осторожны, скидки бывают вплоть до 400%, а значит товар может иметь отрицательную цену - купить его будет нельзя.  
   
Внизу на главной странице можно увидеть специальное предложение - случайно выбранный товар, однако ничего уникального в этом товаре нет.  
  
Товары можно искать в поле "Поиск". Сам поиск работает так: ищутся среди товаров данной категории товары, в наименование которых входит подстрока из поля "Наименование товара", поиск регистрозависимый.  

Товары можно перемещать в корзину, а так же заказывать. Имейте в виду, что при удалении заказа деньги на счет не возвращаются. Возврат происходит только при нажатии кнопки "Вернуть деньги" в разделе заказа.  
  
Веб-сервис позволяет получать доступ к пяти различным магазинам. Выбор магазина определяется случайно. Чтобы получить доступ к другому, можно нажать на иконку магазина. На данный момент выбор магазина не влияет на функционал сервиса.  
  
**Удачных покупок!**

# Архитектура

## Клиентская часть (Frontend)

### Технологии: Flask-шаблонизация.

### Основные компоненты:

1. Главная страница: отображает «случайный магазин» и список товаров в виде превью, а также выделенный «особый» товар (спецпредложение).
2. Страница товара: содержит детальную информацию о конкретном товаре: название, цену, валюту, скидку (если есть) и т. д.
3. Страница корзины: показывает все добавленные в корзину товары с итоговой суммой по каждой валюте.
4. Страница поиска: форма поиска по товарам и категориям.
5. Личный кабинет (User Page): содержит информацию о накопленной сумме денег, разделённой по валютам, а также историю заказов.
6. Раздел заказов: список оформленных заказов, их детали, кнопка возврата денег за заказ.

## Серверная часть (Backend)

### Технологии: Python + Flask.

### Основные модули:

1. API для взаимодействия с клиентом: в виде маршрутов (Flask routes), которые обслуживают все основные действия — от регистрации и авторизации до управления корзиной и заказами.
2. Модуль работы с товарами:
 - Класс Item для описания товара в базе данных (название, категория, описание, цена, фото).
 - Класс Category - категория товара.
3. Модуль работы с валютами:
 - Класс Currency, который содержит информацию о типе валюты, её логотипе, признаке целочисленности.
4. Модуль пользователей:
 - Класс User (регистрация, авторизация, хэширование пароля, поля с именем, возрастом, адресом).
5. Управление магазинами:
 - Класс Store, в базе может храниться несколько «магазинов»; при запуске выбирается один случайный для отображения «статических» настроек (название, логотип и т. п.).
6. Управление заказами:
 - Проводится оформление заказов, проверяется достаточность средств, также доступна опция возврата средств (refund).

ORM: SQLAlchemy для работы с объектами (Item, Category, Currency, Store, User), плюс сессии базы данных (db_session).

## Роли пользователей

### Пользователь (зарегистрированный):

Может просматривать товары, добавлять их в корзину, оплачивать, обменивать валюты, смотреть и редактировать свой профиль, получение бонуса.

### Гость (не авторизован):

Может просматривать публичный контент (каталог, карточки товаров, поиск), но не может добавлять в корзину или оплачивать, обменивать валюты.

# UI и API

## Главная страница

1. Endpoint: GET /

2. Возврат HTML-шаблона main_page.html, в который передаются:
  - Список товаров.
  - Особое предложение.
  - Настройки магазина.

## Страница конкретного товара

1. Endpoint: GET /item/{item_id}

2. Возвращает HTML-шаблон item_page.html с:
  - Изображение товара.
  - Название, цену (с учётом скидки, если она есть).
  - Характеристики товара.

## Страница обмена валют

1. Endpoint: GET /exchange

2. Возвращает HTML-шаблон exchange.html вместе со следующими данными:
  - store_settings (словарь с информацией об оформлении магазина — название, слоган и т.д.).
  - message (по умолчанию None, либо текст ошибки, если передавался в функцию).
  - data (список словарей). Каждый словарь хранит:
    - first_id и second_id — идентификаторы исходной и целевой валюты,
    - first_logo и second_logo — ссылки на изображения (логотипы) этих валют,
    - amount — сгенерированное случайное число, указывающее, сколько единиц «второй» валюты даётся за 1 единицу «первой».

## Страница конкретного заказа

1. Endpoint: GET /order/{order_id}

2. Возвращает HTML-шаблон order.html с данными о заказе, включая:
  - ID заказа.
  - Товары.
  - Общую сумму.

## Страница со всеми заказами

1. Endpoint: GET /orders

2. Возвращает HTML-шаблон orders.html с:
  - Идентификатор каждого заказа.
  - Итоговую стоимость заказа по каждой валюте.

## Страница корзины

1. Endpoint: GET /shopping_cart

2. Вызывается шаблон shopping_cart.html, в который передаются:
  - items — список товаров,
  - summary — словарь с суммами в разных валютах,
  - message (если есть сообщение об ошибке или другом событии),
  - а также настройки текущего магазина (через store_settings).

## Страница поиска товаров

1. Endpoint:
  - GET /search
  - POST /search

2. Описание:
  - GET /search: вызывает шаблон search.html, в который передаются:
    - items — изначально пустой список,
    - form — объект формы (search_form),
    - настройки текущего магазина (через store_settings)

  - POST /search:
    - Произодится поиск в бд, найденные товары (список items) передаются в шаблон search.html, вместе с самим объектом формы и настройками магазина (store_settings).

## Страница входа в аккаунт

1. Endpoint:
  - GET /login
  - POST /login

2. Описание:
  - GET /login: вызывает шаблон login.html, в который передаются:
    - form — объект формы (login_form),
    - настройки текущего магазина (через store_settings)

  - POST /login:
    - вход в аккаунт
    - Если такого логина нет или неправильный пароль, то возвращается шаблон login.html вместе с message и настройками текущего магазина
    - Если данные верные, то вызывается login_user() и возвращается redirect("/") на главную страницу

## Страница регистрации в аккаунт

1. Endpoint:
  - GET /register
  - POST /register

2. Описание:
  - GET /register: вызывает шаблон register.html, в который передаются:
    - form — объект формы (register_form),
    - настройки текущего магазина (через store_settings)

  - POST /register:
    - регистрация нового аккаунта
    - Если пароль не совпадает с повтороряющимся паролем, неверный возрасn или такой пользователь уже есть, то возвращается шаблон register.html вместе с message указывающим на ошибку и настройками текущего магазина
    - Если данные верные, то добавляется новый User и возвращается redirect("/") на главную страницу
   
## Страница редактирования аккаунта

1. Endpoint:
  - GET /edit_account
  - POST /edit_account

2. Описание:
  - GET /register: заполняет register_form текущими данными пользователя, вызывает шаблон register.html, в который передаются:
    - form — объект формы (register_form),
    - настройки текущего магазина (через store_settings)

  - POST /register:
    - редактирование данных аккаунта
    - Если данные неправильные, то вызывается шаблон register.html вызывается повторно с сообщением об ошибке, чтобы пользователь мог исправить данные.
    - Если данные верные, то данные обновляются и возвращается redirect("/user_page") на главную страницу

## Страница FAQ

1. Endpoint: GET /faq

2. Вызывается шаблон faq.html, в который передаются:
  - настройки текущего магазина (через store_settings).

## Страница Delivery FAQ

1. Endpoint: GET /delivery_info

2. Вызывается шаблон delivery.html, в который передаются:
  - настройки текущего магазина (через store_settings).

## Добавление в корзину

1. Endpoint: GET /add_to_cart

2. Описание:
   - Сбор параметров из query-строки
   - Сохранение в json-файле товара и возвращает redirect("/") на главную страницу

## Обмен валют

1. Endpoint: GET /change_currencies

2. Описание:
   - Сбор параметров из query-строки
   - Если не хватает средств первой валюты, то возвращает пользователю страницу обмена с предупреждением
   - Если все хорошо, то возвращает redirect('/exchange') на главную страницу

## Удаление товара из корзины

1. Endpoint: GET /delete_from_cart/{item_id}

2. Описание:
   - Удаление записи из json-файла
   - Возвращает redirect('/shopping_cart') на страницу с корзиной

## Удаление заказа

1. Endpoint: GET /delete_order/{order_id}

2. Описание:
   - Если заказ не существует, то ошибка 404
   - Если заказ существует, то удаление из json-файла и возвращает redirect('/orders') на страницу заказов

## Получение бонуса

1. Endpoint: GET /get_bonus

2. Описание:
   - Добавление случайного количества валют и обновление в json-файле
   - Возвращает redirect(f'/user_page') на страницу пользователя

## Оформление заказа

1. Endpoint: GET /order

2. Описание:
   - Если не хватает средств, то возвращает страницу корзины с предупреждением 
   - Если все хорошо, добавляет запись в json-файл и возвращает redirect('/orders') на страницу заказов

## Возврат средств за заказ

1. Endpoint: GET /refund_order/{order_id}

2. Описание:
   - Если заказа не существует, то возврат ошибки 404
   - Если все хорошо, то возврат средств и возврат delete_order(order_id) на удаление заказа


## Обновление страницы

1. Endpoint: GET /refresh

2. Описание:
   - Обновление магазина но новый и возвращает redirect('/') на главную страницу
